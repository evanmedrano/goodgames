<% content_for(:title, user_friends_title(user: @user).html_safe) %>

<div class="container users-friendships">
  <div class="d-flex align-items-baseline users-friendships__nav">
    <% if current_user == @user %>
      <h2 class="mr-auto">Friends</h2>
      <%= link_to(
        "Friends",
        user_friendships_path(current_user),
        class: "#{active_class(user_friendships_path)}",
      ) %>
      <%= link_to(
        "Friend requests",
        user_friend_requests_path(current_user),
        class: "users-friendships__nav-link",
      ) %>
    <% else %>
      <h2>Friends of <%= @user.first_name %></h2>
      <%= link_to(
        "#{@user.first_name}'s profile'",
        user_friend_requests_path(current_user),
      ) %>
    <% end %>
  </div>

  <div class="row pt-4">
    <div class="col-8">
      <% if @user.friends.empty? %>
        <p>
          <%= @user.first_name %> has no friends yet!
        </p>
      <% else %>
        <div class="users-friendships__search-container">

          <%= form_tag user_friendships_path(@user), method: :get do %>
            <%= text_field_tag(
              :search,
              nil,
              placeholder: "Search the friends list",
              class: "users-friendships__search-box",
            ) %>
            <%= submit_tag "Search", class: "button button--blue ml-4" %>
          <% end %>
        </div>

        <div class="users-friendships__friends-container">
          <p class="u-border-bottom m-0">
            <% if @friends.empty? %>
              Showing 0-0 of 0
            <% else %>
              Showing 1-<%= @friends.size %> of <%= @friends.size %>
            <% end %>
          </p>

          <div class="d-flex py-2 align-items-baseline">
            <%= link_to(
              "All friends",
              user_friendships_path(@user),
              class: "link--teal mr-auto",
            ) %>

            <span>sort by</span>
            <%= form_tag user_friendships_path(@user), method: :get do %>
              <%= select_tag(
                "sort_by",
                options_for_select(
                  [["first name", :first_name],
                  ["last name", :last_name],
                  ["date added", :date_added],
                  ["games added", :games_added],
                  ["friends added", :friends_added]],
                  selected: params[:sort_by],
                ),
                onchange: "this.form.submit();",
                class: "ml-3",
              ) %>
            <% end %>
          </div>

          <% if params[:search] && @friends.empty? %>
            <p class="mt-3">
              Nobody with the name of "<%= params[:search] %>" was found in the
              friends list. Try another search or
              <%= link_to(
                "go back to all friends.",
                user_friendships_path(@user),
                class: "link--blue",
              )%>
            </p>
          <% else %>
            <ul class="users-friendships__friends-list">
              <% @friends.each do |friend| %>
                <li class="users-friendships__friend">
                  <%= link_to friend.name, user_library_path(friend) %>
                </li>
              <% end %>
            </ul>
          <% end %>
        </div>
      <% end %>
    </div>

    <% if current_user == @user %>
      <div class="col-4">
        <p>Find friends</p>
      </div>
    <% end %>
  </div>
</div>
